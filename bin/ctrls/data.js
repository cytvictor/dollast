// Generated by LiveScript 1.3.1
(function(){
  var db, core, coBusboy, debug, log, ref$, out$ = typeof exports != 'undefined' && exports || this;
  db = require('../db');
  core = require('../core');
  coBusboy = require('co-busboy');
  debug = require('debug');
  log = debug('dollast:ctrl:data');
  ref$ = out$;
  ref$.upload = function*(){
    var pid, parts, part;
    this.acquirePrivilege('login');
    pid = this.params.pid;
    parts = coBusboy(this, {
      autoFields: true
    });
    while (part = yield parts) {
      log({
        part: part
      });
      this.body = yield core.upload(pid, part);
    }
    yield db.prob.updData(pid);
    this.body.status = {
      type: "ok",
      msg: "upload successful"
    };
  };
  ref$['delete'] = function*(){
    var pid;
    this.acquirePrivilege('login');
    pid = this.params.pid;
    yield core.deleteTestData(pid, this.params.file);
    this.body = {
      status: {
        type: "ok",
        msg: "data has been deleted"
      }
    };
  };
  ref$.show = function*(){
    var data;
    this.acquirePrivilege('login');
    data = yield db.prob.listDataset(this.params.pid);
    this.body = data;
  };
}).call(this);
