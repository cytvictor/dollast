// Generated by LiveScript 1.4.0
(function(){
  var debug, config, sol, rnd, prob, user, log, bindCtx, out$ = typeof exports != 'undefined' && exports || this;
  debug = require('debug');
  config = require('./config');
  sol = require('./models/sol');
  rnd = require('./models/rnd');
  prob = require('./models/prob');
  user = require('./models/user');
  log = debug("dollast:db");
  out$.sol = sol;
  out$.rnd = rnd;
  out$.prob = prob;
  out$.user = user;
  out$.bindCtx = bindCtx = function(ctx){
    var i$, ref$, len$, obj, results$ = [], this$ = this;
    ctx.acquirePrivilege = function(priv){
      var i$, ref$, len$, ids, results$ = [];
      log("checking privilege: " + priv, ctx.state.user.priv);
      for (i$ = 0, len$ = (ref$ = priv.split(" ")).length; i$ < len$; ++i$) {
        ids = ref$[i$];
        if (config.mode !== "debug" && !ctx.state.user.priv[priv]) {
          throw new Error("failure on privilege checking, " + priv + " required. ");
        }
      }
      return results$;
    };
    for (i$ = 0, len$ = (ref$ = [sol, rnd, prob, user]).length; i$ < len$; ++i$) {
      obj = ref$[i$];
      obj.getCurrentUser = fn$;
      obj.acquirePrivilege = ctx.acquirePrivilege;
      results$.push(obj['throw'] = ctx['throw']);
    }
    return results$;
    function fn$(){
      return ctx.state.user;
    }
  };
}).call(this);
