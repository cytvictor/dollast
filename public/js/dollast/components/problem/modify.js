// Generated by LiveScript 1.4.0
(function(){
  var createClass, connect, I, ref$, onUpdateProblem, onGetProblem, onUploadFiles, toClientFmt, field, iconText, labelField, dropdown, dropzone, log, selector;
  createClass = require('react/addons').createClass;
  connect = require('react-redux').connect;
  I = require('immutable');
  ref$ = require('../../actions'), onUpdateProblem = ref$.onUpdateProblem, onGetProblem = ref$.onGetProblem, onUploadFiles = ref$.onUploadFiles;
  toClientFmt = require('../utils').toClientFmt;
  ref$ = require('../elements'), field = ref$.field, iconText = ref$.iconText, labelField = ref$.labelField, dropdown = ref$.dropdown;
  dropzone = require('react-dropzone');
  log = debug('dollast:component:problem:modify');
  selector = function(state){
    return {
      problem: state.getIn(['problem', 'update'], I.Map({
        outlook: {},
        config: {
          timeLmt: 1,
          spaceLmt: 512,
          stkLmt: 4,
          outLmt: 10,
          dataset: []
        }
      }))
    };
  };
  module.exports = connect(selector)(createClass({
    displayName: 'prob-modify',
    componentDidMount: function(){
      var $form, pid, that;
      $form = $('#problem-modify');
      $form.form({
        on: 'blur',
        fields: {
          title: {
            identifier: 'title',
            rules: [
              {
                type: 'minLength[2]',
                prompt: 'title minimum length is 2'
              }, {
                type: 'maxLength[63]',
                prompt: 'title length cannot exceed 63'
              }
            ]
          },
          rid: {
            identifier: 'rid',
            optional: true,
            rules: [{
              type: 'integer[1..]',
              prompt: '#rid must be a positive integer'
            }]
          },
          judger: {
            identifier: 'judger',
            rules: [{
              type: 'empty',
              prompt: 'please choose your judger'
            }]
          },
          timeLmt: {
            identifier: 'timeLmt',
            rules: [{
              type: 'positive',
              prompt: 'time limit must be positive'
            }]
          },
          spaceLmt: {
            identifier: 'spaceLmt',
            rules: [{
              type: 'positive',
              prompt: 'space limit must be positive'
            }]
          },
          stkLmt: {
            identifier: 'stkLmt',
            rules: [{
              type: 'positive',
              prompt: "stack limit must be positive"
            }]
          },
          outLmt: {
            identifier: 'outLmt',
            rules: [{
              type: 'positive',
              prompt: "output limit must be positive"
            }]
          },
          desc: {
            identifier: 'desc',
            rules: [{
              type: "maxLength[65535]",
              prompt: "description cannot be longer than 65535"
            }]
          },
          inFmt: {
            identifier: 'inFmt',
            rules: [{
              type: "maxLength[65535]",
              prompt: "input format cannot be longer than 65535"
            }]
          },
          outFmt: {
            identifier: 'outFmt',
            rules: [{
              type: "maxLength[65535]",
              prmopt: "output format cannot be longer than 65535"
            }]
          },
          sampleIn: {
            identifier: 'sampleIn',
            rules: [{
              type: "maxLength[65535]",
              prompt: "sample input cannot be longer than 65535"
            }]
          },
          sampleOut: {
            identifier: 'sampleOut',
            rules: [{
              type: "maxLength[65535]",
              prompt: "sample output cannot be longer than 65535"
            }]
          }
        },
        onSuccess: this.submit
      });
      if (this.props.params.pid) {
        this.props.dispatch(onGetProblem(this.props.params.pid, 'update', 'total'));
      }
      pid = (that = this.props.params.pid) ? parseInt(that) : 0;
      return this.setState({
        pid: pid
      });
    },
    submit: function(e){
      var $form, allValues;
      e.preventDefault();
      $form = $('#problem-modify');
      allValues = $form.form('get values');
      return this.props.dispatch(onUpdateProblem(this.state.pid, allValues));
    },
    updateForms: function(problem){
      var $form;
      $form = $('#problem-modify');
      return $form.form('set values', toClientFmt(problem.toJS()));
    },
    componentWillUpdate: function(nextProps, nextStates){
      return this.updateForms(nextProps.problem);
    },
    onDrop: function(files){
      return this.setState({
        files: files
      });
    },
    upload: function(){
      var files;
      files = this.state.files;
      if (files) {
        return this.props.dispatch(onUploadFiles(this.state.pid, files));
      }
    },
    render: function(){
      var problem, problemTitle, title, that, atom;
      problem = this.props.problem.toJS();
      problemTitle = this.props.problem.getIn(['outlook', 'title']);
      title = (that = this.props.params.pid) ? "Update Problem " + that + ". " + problemTitle : "Create Problem";
      return _div({
        className: "ui form segment",
        id: 'problem-modify'
      }, _h1({
        className: "ui centered"
      }, title), _div({
        className: "ui error message"
      }), _div({
        className: "ui three fields"
      }, _(labelField, {
        className: "eight wide",
        text: 'title'
      }, _div({
        className: "ui input"
      }, _input({
        name: 'title'
      }))), _(labelField, {
        className: "four wide",
        text: "round"
      }, _div({
        className: "ui input"
      }, _input({
        name: 'rid',
        type: 'number',
        placeholder: "optional"
      }))), _(labelField, {
        className: "four wide",
        text: 'judger'
      }, _(dropdown, {
        className: 'selection',
        name: 'judger',
        'default': "Please choose a judger",
        options: {
          string: 'string',
          real: 'real',
          strict: 'strict',
          custom: 'custom'
        }
      }))), _div({
        className: "ui four fields"
      }, _(labelField, {
        text: "time limit (s)"
      }, _div({
        className: "ui input"
      }, _input({
        name: 'timeLmt',
        type: 'number'
      }))), _(labelField, {
        text: "space limit (MB)"
      }, _div({
        className: "ui input"
      }, _input({
        name: 'spaceLmt',
        type: 'number'
      }))), _(labelField, {
        text: "stack limit (MB)"
      }, _div({
        className: "ui input"
      }, _input({
        name: 'stkLmt',
        type: 'number'
      }))), _(labelField, {
        text: "output limit (MB)"
      }, _div({
        className: "ui input"
      }, _input({
        name: 'outLmt',
        type: 'number'
      })))), _(field, null, _(labelField, {
        text: 'description'
      }), _textarea({
        name: 'desc'
      })), _div({
        className: "ui two fields"
      }, _(labelField, {
        text: "input format"
      }, _textarea({
        name: 'inFmt'
      })), _(labelField, {
        text: "output format"
      }, _textarea({
        name: 'outFmt'
      }))), _div({
        className: "ui two fields"
      }, _(labelField, {
        text: "sample input"
      }, _textarea({
        name: 'sampleIn'
      })), _(labelField, {
        text: "sample output"
      }, _textarea({
        name: 'sampleOut'
      }))), _div({
        className: "ui divider"
      }), _(field, null, _(iconText, {
        icon: 'file',
        text: 'select',
        onClick: this.select
      }), _(iconText, {
        className: 'green',
        icon: 'upload',
        text: 'upload',
        onClick: this.upload
      }), _(iconText, {
        className: 'teal',
        icon: 'refresh',
        text: 'refresh',
        onClick: this.refresh
      }), _(iconText, {
        className: 'purple',
        icon: 'retweet',
        text: 'repair',
        onClick: this.repair
      })), _div({
        className: "ui two fields"
      }, _(field, {
        className: "four wide"
      }, _(dropzone, {
        onDrop: this.onDrop
      }, _div(null, "drop files here for click to select"))), _(field, {
        className: "twelve wide"
      }, _table({
        className: "ui table segment"
      }, _thead(null, _tr(null, _th(null, 'input'), _th(null, 'output'), _th(null, 'weight'), _th(null, ""))), _tbody(null, (function(){
        var i$, ref$, ref1$, len$, results$ = [];
        for (i$ = 0, len$ = (ref$ = (ref1$ = problem.config) != null ? ref1$.dataset : void 8).length; i$ < len$; ++i$) {
          atom = ref$[i$];
          results$.push(_tr({
            key: atom.input
          }, _td(null, atom.input), _td(null, atom.output), _td(null, atom.weight), _td(null, _(iconText, {
            className: "right floated mini",
            icon: 'remove',
            text: 'remove',
            onClick: this.remove
          }))));
        }
        return results$;
      }.call(this)))))), _(field, null, _(iconText, {
        className: "primary floated submit",
        text: 'Save',
        icon: 'save'
      }), _(iconText, {
        className: "secondary floated",
        text: 'Back',
        icon: 'reply',
        href: "#/problem/" + this.props.params.pid
      })));
    }
  }));
}).call(this);
