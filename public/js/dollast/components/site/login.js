// Generated by LiveScript 1.4.0
(function(){
  var createClass, connect, ref$, field, iconText, iconInput, onLogin, classnames, fromJS, log, selector;
  createClass = require('react').createClass;
  connect = require('react-redux').connect;
  ref$ = require('../elements'), field = ref$.field, iconText = ref$.iconText, iconInput = ref$.iconInput;
  onLogin = require('../../actions').onLogin;
  classnames = require('classnames');
  fromJS = require('immutable').fromJS;
  log = debug('dollast:component:login');
  selector = function(state){
    return {
      user: state.getIn(['db', 'site', 'login', 'post'], fromJS({
        status: 'init'
      }))
    };
  };
  module.exports = connect(selector)(createClass({
    displayName: 'login',
    componentDidMount: function(){
      return $('#login-form').form({
        on: 'blur',
        fields: {
          uid: {
            identifier: 'uid',
            rules: [
              {
                type: 'minLength[6]',
                prompt: "User name must be longer than 5"
              }, {
                type: 'maxLength[16]',
                prompt: "User name must be shorter than 15"
              }
            ]
          },
          pswd: {
            identifier: 'pswd',
            rules: [
              {
                type: 'minLength[6]',
                prompt: 'password length must be longer than 5'
              }, {
                type: 'maxLength[16]',
                prompt: 'password length must be shorter than 15'
              }
            ]
          }
        },
        onSuccess: this.submit,
        debug: true
      });
    },
    submit: function(e){
      var $form;
      e.preventDefault();
      $form = $('#login-form');
      return this.props.dispatch(onLogin($form.form('get values')));
    },
    render: function(){
      var user, classes, ref$;
      user = this.props.user.toJS();
      classes = classnames("ui form segment", {
        loading: user.status === 'wait',
        success: ((ref$ = user.payload) != null ? ref$.token : void 8) != null && user.status === 'done'
      });
      return _('div', {
        className: "ui"
      }, _('h1', {
        className: "ui dividing header"
      }, "Login"), _('form', {
        className: classes,
        id: "login-form"
      }, _('div', {
        className: "ui error message"
      }), _('div', {
        className: "ui success message"
      }, "Login successfully."), _(field, null, _(iconInput, {
        className: "left",
        icon: 'user',
        input: {
          placeholder: "user id",
          name: "uid"
        }
      })), _(field, null, _(iconInput, {
        className: "left",
        icon: 'lock',
        input: {
          placeholder: 'password',
          name: "pswd",
          type: 'password'
        }
      })), _(iconText, {
        className: "left primary labeled submit",
        icon: "sign in",
        text: 'Login'
      })));
    }
  }));
}).call(this);
