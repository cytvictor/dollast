// Generated by LiveScript 1.3.1
var _, app;
_ = require('prelude-ls');
app = angular.module('dollast-rnd-app', ["dollast-crud", "ui.dateTimeInput"]);
app.controller('rnd-list-ctrl', [
  "$scope", "rnd-serv", "$routeParams", function($scope, rndServ, $routeParams){
    return $scope.rounds = rndServ.query();
  }
]);
app.controller('rnd-show-ctrl', [
  "$scope", "rnd-serv", "$routeParams", function($scope, rndServ, $routeParams){
    var rid;
    rid = parseInt($routeParams.rid);
    return $scope.rnd = rndServ.get({
      rid: rid
    });
  }
]);
app.controller('rnd-modify-ctrl', [
  "$scope", "rnd-serv", "prob-serv", "$routeParams", function($scope, rndServ, probServ, $routeParams){
    var that;
    $scope.pid = 0;
    if (that = $routeParams.rid) {
      $scope.rnd = rndServ.get({
        rid: that,
        mode: "total"
      }, function(it){
        return $scope.probs = it.probs;
      });
    } else {
      rndServ.nextCount(function(it){
        $scope.rnd = {
          _id: it._id,
          begTime: new Date(Date.now()),
          endTime: new Date(Date.now())
        };
        $scope.probs = [];
        return console.log("temp: " + JSON.stringify(it));
      });
    }
    $scope.submit = function(){
      var rid;
      console.log($scope.rnd);
      rid = $scope.rnd._id;
      $scope.rnd.probs = _.map(function(it){
        return it._id;
      }, $scope.probs);
      return rndServ.save($scope.rnd);
    };
    $scope.insert = function(){
      return probServ.get({
        pid: $scope.pid,
        mode: "brief"
      }, function(it){
        console.log("ret " + JSON.stringify(it));
        if (it._id) {
          return $scope.probs.push(it);
        } else {
          throw Error('unimplemented');
        }
      });
    };
    $scope.remove = function(pid){
      return $scope.probs = _.reject(function(it){
        return it._id === pid;
      }, $scope.probs);
    };
    return $scope['delete'] = function(){
      return rndServ['delete']({
        rid: $scope.rnd._id
      });
    };
  }
]);
app.controller('rnd-board-ctrl', [
  "$scope", "rnd-serv", "$routeParams", function($scope, rndServ, $routeParams){
    var rid;
    rid = parseInt($routeParams.rid);
    $scope.board = rndServ.board({
      rid: rid
    });
    return $scope.rnd = rndServ.get({
      rid: rid
    });
  }
]);