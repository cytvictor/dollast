// Generated by LiveScript 1.3.1
(function(){
  var _, app;
  _ = require('prelude-ls');
  app = angular.module('dollast-app', ["ngRoute", "ui.dateTimeInput"]);
  app.config([
    '$routeProvider', function($routeProvider){
      return $routeProvider.when('/', {
        templateUrl: 'partials/index.html',
        controller: 'index-ctrl'
      }).when('/problem', {
        templateUrl: 'partials/problem/list.html',
        controller: 'prob-list-ctrl'
      }).when('/problem/create', {
        templateUrl: 'partials/problem/modify.html',
        controller: 'prob-modify-ctrl'
      }).when('/problem/:pid', {
        templateUrl: 'partials/problem/show.html',
        controller: 'prob-show-ctrl'
      }).when('/problem/:pid/modify', {
        templateUrl: 'partials/problem/modify.html',
        controller: 'prob-modify-ctrl'
      }).when('/submit/:pid', {
        templateUrl: 'partials/solution/submit.html',
        controller: 'sol-submit-ctrl'
      }).when('/login', {
        templateUrl: 'partials/login.html',
        controller: 'login-ctrl'
      }).when('/solution', {
        templateUrl: 'partials/solution/list.html',
        controller: 'sol-list-ctrl'
      }).when('/solution/:sid', {
        templateUrl: 'partials/solution/show.html',
        controller: 'sol-show-ctrl'
      }).when('/round', {
        templateUrl: 'partials/round/list.html',
        controller: 'rnd-list-ctrl'
      }).when('/round/create', {
        templateUrl: 'partials/round/modify.html',
        controller: 'rnd-modify-ctrl'
      }).when('/round/:rid', {
        templateUrl: 'partials/round/show.html',
        controller: 'rnd-show-ctrl'
      }).when('/round/:rid/modify', {
        templateUrl: 'partials/round/modify.html',
        controller: 'rnd-modify-ctrl'
      }).otherwise({
        templateUrl: 'partials/404.html'
      });
    }
  ]);
  app.service('doffirst', [
    '$http', (function(){
      var prototype = constructor.prototype;
      function constructor($http){
        this.$http = $http;
        this.caller = function(obj, opts, cb, http){
          return http.success(function(data, status, headers, config){
            var opts, cb;
            if (typeof opts === 'undefined') {
              opts = {};
            } else if (typeof opts === 'function') {
              cb = opts;
              opts = {};
            }
            import$(obj, data);
            if (opts.debug) {
              console.log("data: " + JSON.stringify(data));
            }
            if (cb) {
              return cb($scope);
            }
          });
        };
      }
      prototype.get = function(url, obj, opts, cb){
        return this.caller(obj, opts, cb, this.$http.get(url));
      };
      prototype.put = function(url, data, obj, opts, cb){
        return this.caller(obj, opts, cb, this.$http.put(url, data));
      };
      prototype.post = function(url, data, opts, cb){
        return this.caller(obj, opts, cb, this.$http.post(url, data));
      };
      prototype['delete'] = function(url, opts, cb){
        return this.caller(obj, opts, cb, this.$http['delete'](url));
      };
      return constructor;
    }())
  ]);
  app.controller('navbar-ctrl', [
    "$scope", "doffirst", function($scope, doffirst){
      return doffirst.get('/session', $scope);
    }
  ]);
  app.controller('index-ctrl', [
    "$scope", "$http", "$location", function($scope, $http, $location){
      return $scope.submit = function(){
        return $location.path("/solution");
      };
    }
  ]);
  app.controller('login-ctrl', [
    "$scope", "$http", function($scope, $http){
      $scope.user = {
        username: '',
        password: ''
      };
      return $scope.submit = function(user){
        console.log(user);
        return $http.post('/login', $scope.user).success(function(data, status, headers, config){
          return console.log('login OK');
        }).error(function(data, status, headers, config){
          return console.log('login Error');
        });
      };
    }
  ]);
  app.controller('prob-show-ctrl', [
    "$scope", "$http", "$routeParams", function($scope, $http, $routeParams){
      $scope.pid = parseInt($routeParams.pid);
      return $http.get("/problem/" + $scope.pid).success(function(data, status, headers, config){
        console.log(data);
        return $scope.prob = data;
      });
    }
  ]);
  app.controller('prob-list-ctrl', [
    "$scope", "$http", "$routeParams", function($scope, $http, $routeParams){
      return $http.get("/problem").success(function(data, status, headers, config){
        console.log("data: " + data);
        return $scope.probs = data;
      });
    }
  ]);
  app.controller('prob-modify-ctrl', [
    "$scope", "$http", "$routeParams", function($scope, $http, $routeParams){
      var that, pid;
      if (that = $routeParams.pid) {
        pid = parseInt(that);
        $http.get("/problem/" + pid + "/modify").success(function(data, status, headers, config){
          var ref$;
          $scope.prob = (ref$ = clone$(data), ref$._id = pid, ref$);
          return console.log(data);
        });
      } else {
        $http.get("/problem/create").success(function(data, status, headers, config){
          console.log(data);
          return $scope.prob = data;
        });
      }
      return $scope.submit = function(){
        console.log($scope.prob);
        return $http.put("/problem/" + pid, $scope.prob);
      };
    }
  ]);
  app.controller('sol-submit-ctrl', [
    "$scope", "$http", "$routeParams", "$location", function($scope, $http, $routeParams, $location){
      $scope.pid = parseInt($routeParams.pid);
      $scope.lang = 'C++';
      return $scope.submit = function(){
        $http.post('/submit', {
          code: $scope.code,
          pid: $scope.pid,
          lang: $scope.lang
        });
        return $location.path("/solution");
      };
    }
  ]);
  app.controller('sol-list-ctrl', [
    "$scope", "$http", "$routeParams", function($scope, $http, $routeParams){
      return $http.get("/solution").success(function(data, status, headers, config){
        console.log("data: " + data);
        return $scope.sols = data;
      });
    }
  ]);
  app.controller('sol-show-ctrl', [
    "$scope", "$http", "$routeParams", function($scope, $http, $routeParams){
      $scope.sid = parseInt($routeParams.sid);
      return $http.get("/solution/" + $scope.sid).success(function(data, status, headers, config){
        console.log("data: " + data);
        return $scope.sol = data;
      });
    }
  ]);
  app.controller('rnd-list-ctrl', [
    "$scope", "$http", "$routeParams", function($scope, $http, $routeParams){
      return $http.get("/round").success(function(data, status, headers, config){
        console.log(data);
        return $scope.rounds = data;
      });
    }
  ]);
  app.controller('rnd-show-ctrl', [
    "$scope", "$http", "$routeParams", function($scope, $http, $routeParams){
      var rid;
      rid = parseInt($routeParams.rid);
      return $http.get("/round/" + rid).success(function(data, status, headers, config){
        console.log(data);
        return import$($scope, data);
      });
    }
  ]);
  app.controller('rnd-modify-ctrl', [
    "$scope", "$http", "$routeParams", function($scope, $http, $routeParams){
      var that;
      $scope.pid = 0;
      if (that = $routeParams.rid) {
        $http.get("/round/" + that + "/modify").success(function(data, status, headers, config){
          var ref$;
          $scope.rnd = (ref$ = clone$(data), ref$._id = that, ref$);
          $scope.probs = data.probs;
          return console.log("initial " + $scope.probs);
        });
      } else {
        $http.get("/round/create").success(function(data, status, headers, config){
          var ref$;
          $scope.rnd = (ref$ = clone$(data), ref$.begTime = new Date(Date.now()), ref$.endTime = new Date(Date.now()), ref$);
          return $scope.probs = [];
        });
      }
      $scope.submit = function(){
        console.log($scope.rnd);
        $scope.rnd.probs = _.map(function(it){
          return it._id;
        }, $scope.probs);
        console.log(typeof $scope.rnd.probs);
        return $http.put("/round/" + $scope.rnd._id, $scope.rnd);
      };
      $scope.insert = function(){
        return $http.get("/problem/" + $scope.pid).success(function(data, status, headers, config){
          return $scope.probs.push(data);
        });
      };
      $scope.remove = function(pid){
        return $scope.probs = _.reject(function(it){
          return it._id === pid;
        }, $scope.probs);
      };
      return $scope['delete'] = function(){
        return $http['delete']("/round/" + $scope.rnd._id);
      };
    }
  ]);
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
  function clone$(it){
    function fun(){} fun.prototype = it;
    return new fun;
  }
}).call(this);
